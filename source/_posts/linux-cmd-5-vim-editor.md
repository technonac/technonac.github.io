---
title: Linux命令行(5)vim编辑器
date: 2018-02-18 23:33:50
tags: 
    - Linux
    - Shell
---
vi编辑器是Unix系统最初的编辑器。它使用控制台图形模式来模拟文本编辑窗口，允许查看文件中的行、在文件中移动、插入、编辑和替换文本
在GNU项目将vi编辑器移植到开源世界时，他们决定对其作一些改进。由于它不再是以前Unix中的那个原始的vi编辑器了，开发人员也就将它重命名为vi improved，或vim

## 检查 vim 软件包

在有些发行版中安装的是完整的vim，另外还有一个 vi 命令的别名，

就像下面所显示的CentOS发行版中的那样。

```bash
$ alias vi
alias vi='vim'
$
$ which vim
/usr/bin/vim
$
$ ls -l /usr/bin/vim
-rwxr-xr-x. 1 root root 1967072 Apr  5  2012 /usr/bin/vim
```

要注意的是，在Ubuntu发行版中不仅没有 vi 命令的别名，而且 /usr/bin/vi 程序属于一系列文件链接中的一环。

```bash
$ alias vi
-bash: alias: vi: not found
$
$ which vi
/usr/bin/vi
$
$ ls -l /usr/bin/vi
lrwxrwxrwx 1 root root 20 Apr 22 12:39 
/usr/bin/vi -> /etc/alternatives/vi
$
$ ls -l /etc/alternatives/vi
lrwxrwxrwx 1 root root 17 Apr 22 12:33 
/etc/alternatives/vi -> /usr/bin/vim.tiny
$
$ ls -l /usr/bin/vim.tiny
-rwxr-xr-x 1 root root 884360 Jan  2 14:40 
/usr/bin/vim.tiny
$
$ readlink -f /usr/bin/vi
/usr/bin/vim.tiny
```

当输入 vi 命令时，执行的是程序 /usr/bin/vim.tiny 。 vim.tiny 只提供少量的vim编辑器功能。

```bash
# 安装完整版的vim
$ sudo apt-get install vim
```

## vim 基础

vim编辑器在内存缓冲区中处理数据。通过vim/vi命令启动vim编辑器 
```bash
$ vim test.c
```

vim编辑器有两种操作模式： 

>  普通模式(默认模式)

>  插入模式 (`i`键切换，`esc`键退出)

vim中有用来移动光标的命令

```
h ：左移一个字符。
j ：下移一行（文本中的下一行）
k ：上移一行（文本中的上一行）
l ：右移一个字符
```

在大的文本文件中提高移动速度的命令

```
PageDown （或Ctrl+F）：下翻一屏。
PageUp （或Ctrl+B）：上翻一屏。
G ：移到缓冲区的最后一行。
num G ：移动到缓冲区中的第 num 行。
gg ：移到缓冲区的第一行。
```

### 命令行模式

vim编辑器在普通模式下有个特别的功能叫命令行模式。命令行模式提供了一个交互式命令行，可以输入额外的命令来控制vim的行为在普通模式下按下冒号键进入命令行模式。光标会移动到消息行，然后出现冒号，等待输入命令

```bash
q ：如果未修改缓冲区数据，退出。
q! ：取消所有对缓冲区数据的修改并退出。
w filename ：将文件保存到另一个文件中。
wq ：将缓冲区数据保存到文件中并退出。
```

### 编辑数据

在普通模式下，vim编辑器提供了一些命令来编辑缓冲区中的数据。 在普通模式下。vim编辑器通常会将删除键（Delete键）识别成 x 命令的功能，删除当前光标所在位置的字符。vim编辑器在普通模式下通常不识别退格键（Backspace键）

```
x  删除当前光标所在位置的字符 
dd  删除当前光标所在行 
dw  删除当前光标所在位置的单词 
d$  删除当前光标所在位置至行尾的内容 
J  删除当前光标所在行行尾的换行符（拼接行） 
u  撤销前一编辑命令 
a  在当前光标后追加数据 
A  在当前光标所在行行尾追加数据 
r char  用char替换当前光标所在位置的单个字符 
R text  用text覆盖当前光标所在位置的数据，直到按下ESC键
---------------------------------------------------------
2x 会删除从光标当前位置开始的两个字符
5dd 会删除从光标当前所在行开始的5行
```

### 复制和粘贴

```bash
# 剪切(vim在删除数据时，实际上会将数据保存在单独的一个寄存器中)
dd
# 复制y(yank)
y
# 复制一个单词
yw
# 复制到行尾
y$
# 粘贴(将文本插入到当前光标所在行之后)
p
```

### 可视模式

复制时你无法确定到底复制了什么东西，直到将它粘贴到其他地方才能明白，vim提供了可视模式(v键进入)。

可视模式会在你移动光标时高亮显示文本。可以用可视模式选取要复制的文本。要进入可视模式，应移动光标到要开始复制的位置，通过v键进入。你会注意到光标所在位置的文本已经被高亮显示了。下一步，移动光标来覆盖你想要复制的文本。在移动光标时，vim会高亮显示复制区域的文本。在覆盖了要复制的文本后，按y键来激活复制命令。现在寄存器中已经有了要复制的文本，移动光标到你要放置的位置，使用 p 命令来粘贴。

### 查找和替换

要输入一个查找字符串，就按下斜线（/）键。光标会跑到消息行，然后vim会显示出斜线。在输入你要查找的文本后，按下回车键。vim编辑器会采用以下三种回应中的一种。

> 如果要查找的文本出现在光标当前位置之后，则光标会跳到该文本出现的第一个位置。

> 如果要查找的文本未在光标当前位置之后出现，则光标会绕过文件末尾，出现在该文本所在的第一个位置（并用一条消息指明）。

> 输出一条错误消息，说明在文件中没有找到要查找的文本。

要继续查找同一个单词，按下斜线键，然后按回车键。或者使用n键，表示下一个（next）。

替换命令允许你快速用另一个单词来替换文本中的某个单词。必须进入命令行模式才能使用替换命令。替换命令的格式是：

```bash
:s/old/new/
```

vim编辑器会跳到 old 第一次出现的地方，并用 new 来替换。可以对替换命令作一些修改来替换多处文本

```bash
:s/old/new/g ：一行命令替换所有old
:n,ms/old/new/g ：替换行号 n 和 m 之间所有old
:%s/old/new/g ：替换整个文件中的所有old
:%s/old/new/gc ：替换整个文件中的所有 old ，但在每次出现时提示
```

## 参考书目

《Linux命令行与shell脚本编程大全》第3版